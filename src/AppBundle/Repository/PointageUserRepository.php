<?php

namespace AppBundle\Repository;

/**
 * PointageUserRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class PointageUserRepository extends \Doctrine\ORM\EntityRepository
{
    public function getPointages($v = null)
    {   
        $q = $this->createQueryBuilder('p');
        $q  ->join('p.user','u')
            ->join('p.pointage','pp')
            ;
        if ($v==1)
        {
            $d = new \DateTime("now");
            $q->where('p.date = :d');
            $q->setParameter('d', $d);
        }
            
        return $q;//->getQuery()->getResult();
    }

    public function addFilterPointage($q,$user,$du,$au){
        
        
        if ($du !== null){
            $q->andWhere('p.date >= :du');
            $q->setParameter('du',$du);
        }
        if ($au !== null){
            $q->andWhere('p.date <= :au');
            $q->setParameter('au',$au);
        }
        if ($user !== null){
            $q->andWhere('u = :user');
            $q->setParameter('user',$user);
        }
        return $q;
    }
}
